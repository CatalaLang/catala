/* This file has been generated by the Catala compiler, do not edit! */

#include <stdio.h>
#include <stdlib.h>
#include <runtime.c>


typedef struct Foo {
  CATALA_BOOL x;
  CATALA_DEC y;
} Foo;

typedef struct Baz {
  CATALA_DEC b;
  const CATALA_ARRAY(CATALA_DEC) c;
} Baz;

enum Bar_code {
  Bar_No,
  Bar_Yes
} Bar_code;

typedef struct Bar {
  enum Bar_code code;
  union {
    CATALA_UNIT No;
    const Foo* Yes;
  } payload;
} Bar;

typedef struct Baz_in {
  const catala_closure* a_in;
} Baz_in;

const Baz* baz (const Baz_in* baz_in)
{
  const catala_closure* a;
  const Bar* a2;
  const CATALA_OPTION(Bar*) a3;
  const catala_closure* code_and_env;
  const CATALA_OPTION(Bar*) a4;
  const Bar* a1;
  CATALA_DEC b1;
  const CATALA_OPTION(CATALA_DEC) b2;
  const CATALA_OPTION(CATALA_DEC) b3;
  CATALA_BOOL b4;
  CATALA_DEC b;
  const CATALA_ARRAY(CATALA_DEC) c1;
  const CATALA_OPTION(CATALA_ARRAY(CATALA_DEC)) c2 =
    catala_malloc(sizeof(catala_option));
  CATALA_ARRAY(CATALA_DEC) c3 = catala_malloc(sizeof(catala_array));
  const CATALA_ARRAY(CATALA_DEC) c;
  Baz* Baz = catala_malloc(sizeof(Baz));
  a = baz_in->a_in;
  code_and_env = a;
  a4 = ((const CATALA_OPTION(Bar*)(*)(const CLOSURE_ENV, CATALA_UNIT))
        code_and_env->funcp)(code_and_env->env, CATALA_UNITVAL);
  if (a4->code == catala_option_some) {
    const Bar* x = a4->payload;
    a3 = catala_some(x);
  } else {
    const Bar* a5;
    const CATALA_OPTION(Bar*) a6 = catala_malloc(sizeof(catala_option));
    Bar* a7 = catala_malloc(sizeof(Bar));
    a7->code = Bar_No;
    a7->payload.No = CATALA_UNITVAL;
    a6 = catala_some(a7);
    if (a6->code == catala_option_some) {
      const Bar* arg = a6->payload;
      a5 = arg;
    } else {
      CATALA_UNIT pos;
      static const catala_code_position pos[1] =
        {{"tests/backends/simple.catala_en", 11, 11, 11, 12}};
      catala_error(catala_no_value, pos);
    }
    a3 = catala_some(a5);
  }
  if (a3->code == catala_option_some) {
    const Bar* arg = a3->payload;
    a2 = arg;
  } else {
    CATALA_UNIT pos;
    static const catala_code_position pos[1] =
      {{"tests/backends/simple.catala_en", 11, 11, 11, 12}};
    catala_error(catala_no_value, pos);
  }
  a1 = a2;
  switch (a1->code) {
    case Bar_No: {
      b4 = CATALA_TRUE;
      break;
    }
    case Bar_Yes: {
      b4 = CATALA_FALSE;
      break;
    }
  }
  if (b4 == CATALA_TRUE) {
    b3 = catala_some(catala_new_dec_str("42"));
  } else {
    b3 = CATALA_NONE;
  }
  if (b3->code == catala_option_some) {
    CATALA_DEC x = b3->payload;
    b2 = catala_some(x);
  } else {
    CATALA_DEC b5;
    switch (a1->code) {
      case Bar_No: {
        b5 = catala_new_dec_str("0");
        break;
      }
      case Bar_Yes: {
        Foo* foo = a1->payload.Yes;
        CATALA_DEC b6;
        if (foo->x == CATALA_TRUE) {
          b6 = catala_new_dec_str("1");
        } else {
          b6 = catala_new_dec_str("0");
        }
        b5 = o_add_rat_rat(foo->y, b6);
        break;
      }
    }
    b2 = catala_some(b5);
  }
  if (b2->code == catala_option_some) {
    CATALA_DEC arg = b2->payload;
    b1 = arg;
  } else {
    CATALA_UNIT pos;
    static const catala_code_position pos[1] =
      {{"tests/backends/simple.catala_en", 12, 10, 12, 11}};
    catala_error(catala_no_value, pos);
  }
  b = b1;
  c3->size = 2;
  c3->elements = catala_malloc(2 * sizeof(void*));
  c3->elements[0] = b;
  c3->elements[1] = b;
  c2 = catala_some(c3);
  if (c2->code == catala_option_some) {
    const CATALA_ARRAY(CATALA_DEC) arg = c2->payload;
    c1 = arg;
  } else {
    CATALA_UNIT pos;
    static const catala_code_position pos[1] =
      {{"tests/backends/simple.catala_en", 13, 10, 13, 11}};
    catala_error(catala_no_value, pos);
  }
  c = c1;
  Baz->b = b;
  Baz->c = c;
  return Baz;
}

int main (int argc, char** argv)
{
  catala_init();
  return 0;
}
