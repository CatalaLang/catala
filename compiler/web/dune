; Generate stdlib_files.ml using crunch - embeds all .catala_* files

(rule
 (target stdlib_files.ml)
 (deps
  (glob_files ../../stdlib/*.catala_*))
 (action
  (run
   ocaml-crunch
   -e
   catala_en
   -e
   catala_fr
   -e
   catala_pl
   -m
   plain
   -o
   %{target}
   ../../stdlib)))

(executable
 (name catala_web_interpreter)
 (modes byte js)
 (modules catala_web_interpreter stdlib_files stdlib_embedded)
 (link_flags
  (:standard -linkall))
 (js_of_ocaml
  (flags
   (:standard --effects=cps)))
 (preprocess
  (pps js_of_ocaml-ppx))
 (libraries
  catala.driver
  js_of_ocaml
  catala.runtime_ocaml
  catala.runtime_jsoo
  catala.stdlib_internals
  zarith_stubs_js))

(install
 (section bin)
 (package catala)
 (files
  (catala_web_interpreter.bc.js as catala_web_interpreter.js)))
