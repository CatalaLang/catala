#!/usr/bin/make -f
# -*- makefile -*-

include /usr/share/ocaml/ocamlvars.mk

%:
	dh $@ --with ocaml --buildsystem ocaml_dune

ifneq (,$(filter parallel=%,$(DEB_BUILD_OPTIONS)))
  NUMJOBS = -j $(patsubst parallel=%,%,$(filter parallel=%,$(DEB_BUILD_OPTIONS)))
endif

export CATALA_VERSION = $(shell dpkg-parsechangelog --show-field Version)
BDIR = _build/install/default/bin
MANDIR = debian/tmp/usr/man/man1

override_dh_auto_build:
	dune build $(NUMJOBS) -p catala
	install -Dt $(MANDIR) -m 644 _build/install/default/man/man1/*.1

override_dh_auto_test:
	dune runtest $(NUMJOBS) --release compiler build_system stdlib runtimes
